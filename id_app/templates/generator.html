{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator</title>
    <link rel="stylesheet" href="{% static '/style.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row d-flex bg-black align-items-center" style="height: 80px;">
      <div class="col-6">
        <h3 class="text-white">ID Card generator</h3>
      </div>
      <div class="col-6"></div>
    </div>
    <div class="row text-center">
        
            <nav class="navbar navbar-expand navbar-light bg-white">
                <div class="mx-auto">
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                      <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                          <a class="nav-link" href="{% url 'generator' %}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'institutions' %}">Institutions</a>
                          </li>
                        <li class="nav-item">
                          <a class="nav-link" href="{% url 'students' %}">Students</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'viewcards' %}">Card Styles</a>
                        </li>
                      </ul>
                    </div>
                </div>
            </nav>
        
    </div> 
  </div>
  {% block content %}
  <div class="container-fluid">
      <div class="row justify-content-center" style="background-size: cover; background-position: center; background-attachment: fixed; height: 200px; overflow: hidden; background-image: url('{% static 'img/institution.jpg' %}');" >
          <h1 style="margin: auto;font-size: 80px;" class="text-primary">Generate for Institutions</h1>
      </div>
      <div class="container-fluid">
          <div class="row">
              {% for i in idata %}
              <div class="col-2 d-flex justify-content-center m-3">
                  <div class="box">
                      <a><button class="close-btn">X</button></a>
                          <div class="logo-box text-center m-3" >
                              <img class="cardimg" src="{{ i.institutionLogo.url }}" >
                          </div>
                          <div class="half-box justify-content-center ">
                              <h5 class="text-center">{{ i.institutionName }}</h5>
                          </div>
                  </div>
              </div>
              {% endfor %}
          </div>
      </div>
      <div class="row justify-content-center" style="background-size: cover; background-position: center; background-attachment: fixed; height: 200px; overflow: hidden; background-image: url('{% static 'img/student.jpg' %}');" >
        <h1 class="text-warning" style="margin: auto;font-size: 80px;">Add Students</h1>
    </div>
    <div class="row justify-content-center">
        {% for i in sdata %}
        <div class="col-4 m-3 d-flex justify-content-center">
            <!-- Unique ID for each card -->
            <div id="gen-{{ forloop.counter }}" class="id-card">
                <div class="institution">
                    <div class="i-image">
                        <img class="i-logo"  src="{{ i.sinstitution.institutionLogo.url }}" alt="institution">
                    </div>
                    <div class="i-details">
                        <h5 class="text-center">{{ i.sinstitution.institutionName }}</h5>
                        <p class="text-center">{{ i.sinstitution.institutionAddress }}</p>
                        <p class="text-start">Email: {{ i.sinstitution.institutionEmail }}, Contact: {{ i.sinstitution.institutionNumber }}</p>
                    </div>
                </div>
                <div class="photo">
                    <img src="{{ i.studentPhoto.url }}" alt="ID Photo">
                </div>
                <div class="details">
                    <h2 class="text-center">{{ i.studentName }}</h2>
                    <p class="text-center">{{ i.studentRollnumber }}</p>
                    <div class="info">
                        <p>Phone Number: {{ i.studentNumber }}</p>
                        <p>Address: {{ i.studentAddress1 }}, {{ i.studentAddress2 }}, {{ i.studentAddress3 }}</p>
                        <p>Department: {{ i.studentDepartment }}</p>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- Pass the unique ID to the button -->
                <button class="hollow-butn ms-3" data-id="gen-{{ forloop.counter }}">Download ID Card</button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
</div>
{% endblock %}
</div>

<script>
// Handle download for each button
document.querySelectorAll('.download-btn').forEach(function(button) {
button.addEventListener('click', function() {
    const cardId = this.getAttribute('data-id');
    const cardElement = document.getElementById(cardId);
    
    if (!cardElement) {
        console.error("ID card element not found");
        return;
    }

    // Use html2canvas to capture the card
    html2canvas(cardElement, { scale: 1 }).then(function(canvas) {
        const link = document.createElement('a');
        link.href = canvas.toDataURL("image/png");
        link.download = 'id-card.png';

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }).catch(function(error) {
        console.error("Error generating image: ", error);
    });
});
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>